這是一個使用 PyTorch 和 ResNet34 深度學習模型，對戴口罩的人臉圖片進行情緒辨識的專案。專案從一個複雜的 7 分類問題開始，透過系統性的分析與優化，最終聚焦於一個高性能的「正面/負面」情緒二元分類器。

整個開發流程涵蓋了資料前處理、兩階段遷移學習、加權損失與 Focal Loss 優化、以及專業的程式碼模組化重構。

## 最終模型表現

在二元分類任務（正面情緒 vs. 負面情緒）上，最終模型達到了以下性能：

* **整體準確率 (Accuracy): ~77.8%**
* **平均 F1-Score (Macro Avg F1-Score): ~0.778**

這證明了模型在面對從未見過的資料時，具備良好且均衡的判斷能力。

## 專案特色

-   **先進的訓練策略**：採用兩階段遷移學習及 **Focal Loss**，有效處理類別不平衡與困難樣本問題。
-   **模組化程式碼**：專案結構清晰，將**設定 (`config`)**、**模型 (`model`)**、**工具函式 (`utils`)** 與主流程分離，易於維護和擴展。
-   **完整的開發流程**：涵蓋從資料準備、模型訓練、視覺化分析、結果評估到程式碼重構的完整機器學習工作流程。
-   **可重現性**：提供完整的資料準備腳本與環境設定檔案，讓任何人都能輕鬆重現此專案。

## 專案結構

```
/
|-- /data/                  <-- 資料集存放處 (需手動建立與準備)
|-- /src/                   <-- 所有 Python 原始碼
|   |-- __init__.py         <-- 將 src 定義為一個 Python 包裹
|   |-- config.py           <-- 專案全域設定檔
|   |-- model.py            <-- 模型架構與損失函數定義
|   |-- utils.py            <-- 資料載入、繪圖等輔助函式
|   |-- train.py            <-- 主訓練腳本
|   |-- evaluate.py         <-- 主評估腳本
|   |-- organize_binary_data.py <-- 資料格式轉換工具
|
|-- /saved_models/          <-- 訓練好的模型儲存處 (腳本會自動建立)
|-- .gitignore              <-- Git 忽略清單
|-- README.md               <-- 您正在閱讀的檔案
|-- requirements.txt        <-- 專案依賴函式庫
```

## 環境設置與執行指南

請依照以下步驟來設定您的本地環境並完整運行此專案。

### 步驟 1：Clone 專案

```bash
git clone [您的 GitHub 倉庫連結]
cd [專案資料夾名稱]
```

### 步驟 2：安裝依賴函式庫

建議在 Python 3.9 或更高版本的虛擬環境中進行。執行以下命令來安裝所有必要的函式庫：
```bash
pip install -r requirements.txt
```

### 步驟 3：下載並放置原始資料集

本專案使用的資料集，源於對 `FER-2013` 資料集進行口罩合成的版本。

1.  **前往 Kaggle 下載資料集**：
    * [MaskedDatasetFER on Kaggle](https://www.kaggle.com/datasets/shubhangigarg/maskeddatasetfer)

2.  **解壓縮並放置資料**：
    * 在專案根目錄下，手動建立一個名為 `data` 的資料夾。
    * 下載完成後，將解壓縮得到的 `train` 和 `test` (建議將 `test` 改名為 `validation`) 資料夾，放入一個名為 `masked_dataset` 的資料夾中。
    * 將整個 `masked_dataset` 資料夾移動到剛剛建立的 `data` 資料夾底下。

    完成後的路徑應如下所示：
    ```
    /project_root/
    |-- /data/
        |-- /masked_dataset/
            |-- /train/
            |   |-- angry/
            |   |-- happy/
            |   |-- ... (共7個類別)
            |-- /validation/
                |-- angry/
                |-- ...
    ```

### 步驟 4：執行資料格式轉換

我們的專案最終是進行二元分類。請執行我們提供的腳本，將原始的 7 分類資料集，自動轉換為「正面/負面」的 2 分類格式。

在專案**根目錄**執行 (請注意 `-m` 參數)：
```bash
python -m src.organize_binary_data
```
執行完畢後，您的 `/data` 資料夾中會出現一個新的 `masked_dataset_binary` 資料夾，這就是我們訓練要用的資料。

---

## 如何使用

### 訓練新模型

所有訓練參數（如學習率、週期數、模型名稱等）都集中在 `src/config.py` 中，方便統一修改。

在專案**根目錄**執行以下命令開始訓練：
```bash
python -m src.train
```
訓練完成後，學習曲線圖將會自動顯示，且最佳模型將儲存於 `saved_models` 資料夾中（檔名由 `config.py` 中的 `SAVE_PATH` 決定）。

### 評估已訓練的模型

執行以下命令，來載入已訓練好的模型，並在驗證集上產生詳細的評估報告與混淆矩陣：
```bash
python -m src.evaluate
```
